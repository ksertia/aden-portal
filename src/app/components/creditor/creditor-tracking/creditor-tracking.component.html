<div class="tracking-container">
    <div class="tracking-header fade-in-up">
    <h1>Suivi Temps Réel</h1>
    <p>Suivez l'état d'avancement de vos dossiers en temps réel</p>
    </div>

    <div class="tracking-content fade-in-up">
    <!-- Tableau de bord en temps réel -->
    <div class="realtime-dashboard">
        <div class="dashboard-grid">
        <div class="dashboard-card">
            <div class="card-header">
            <h3>Activité récente</h3>
            <div class="live-indicator">
                <div class="pulse"></div>
                <span>En direct</span>
            </div>
            </div>
            <div class="activity-list">
            <div class="activity-item" *ngFor="let activity of recentActivities">
                <div class="activity-icon" [ngClass]="getActivityIconClass(activity.type)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4"/>
                    <circle cx="12" cy="12" r="9"/>
                </svg>
                </div>
                <div class="activity-content">
                <div class="activity-description">{{ activity.description }}</div>
                <div class="activity-time">{{ getTimeAgo(activity.date) }}</div>
                </div>
            </div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="card-header">
            <h3>Statuts des dossiers</h3>
            </div>
            <div class="status-chart">
            <div class="status-item" *ngFor="let status of statusDistribution">
                <div class="status-bar">
                <div class="status-fill" [style.width.%]="status.percentage" [ngClass]="'status-' + status.key"></div>
                </div>
                <div class="status-info">
                <span class="status-label">{{ status.label }}</span>
                <span class="status-count">{{ status.count }}</span>
                </div>
            </div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="card-header">
            <h3>Performances</h3>
            </div>
            <div class="performance-metrics">
            <div class="metric-item">
                <div class="metric-value">{{ formatCurrency(monthlyRecovered) }}</div>
                <div class="metric-label">Recouvré ce mois</div>
                <div class="metric-trend positive">+12%</div>
            </div>
            <div class="metric-item">
                <div class="metric-value">{{ averageRecoveryTime }} jours</div>
                <div class="metric-label">Délai moyen</div>
                <div class="metric-trend negative">-3 jours</div>
            </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Liste des dossiers avec suivi détaillé -->
    <div class="detailed-tracking">
        <div class="tracking-header-section">
        <h2>Suivi détaillé des dossiers</h2>
        <button class="btn btn-secondary" (click)="refreshData()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23,4 23,10 17,10"/>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            Actualiser
        </button>
        </div>

        <div class="tracking-grid">
        <div class="tracking-card" *ngFor="let case of trackedCases">
            <div class="tracking-card-header">
            <div class="case-info">
                <h3>{{ case.caseNumber }}</h3>
                <p>{{ case.debtor.firstName }} {{ case.debtor.lastName }}</p>
            </div>
            <span class="status-badge" [ngClass]="'status-' + case.status">
                {{ getStatusLabel(case.status) }}
            </span>
            </div>

            <div class="tracking-card-body">
            <div class="progress-section">
                <div class="progress-info">
                <span>Progression du recouvrement</span>
                <span class="progress-percentage">{{ getPaymentPercentage(case) }}%</span>
                </div>
                <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getPaymentPercentage(case)"></div>
                </div>
                <div class="amount-info">
                <span>{{ formatCurrency(case.amountPaid) }} / {{ formatCurrency(case.amount) }}</span>
                </div>
            </div>

            <div class="timeline-section">
                <h4>Chronologie</h4>
                <div class="timeline">
                <div class="timeline-item" *ngFor="let event of getRecentEvents(case)">
                    <div class="timeline-dot" [ngClass]="getEventClass(event.type)"></div>
                    <div class="timeline-content">
                    <div class="timeline-description">{{ event.description }}</div>
                    <div class="timeline-date">{{ formatDate(event.date) }}</div>
                    </div>
                </div>
                </div>
            </div>

            <div class="next-actions">
                <h4>Prochaines actions</h4>
                <div class="action-list">
                <div class="action-item" *ngFor="let action of getNextActions(case)">
                    <div class="action-icon">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12,6 12,12 16,14"/>
                    </svg>
                    </div>
                    <span>{{ action }}</span>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>
</div>